<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="./jquery.facedetection.min.js"></script>
</head>

<body>
<!--<video id="video" autoplay playsinline style="display:none"></video>-->
<video id="video" autoplay playsinline></video>
<!--<canvas id="canvas"></canvas>-->
<style>
#video {
  display: block;
  _width: 100%;
}

.face {
  border: 2px solid #FFF;
}
</style>
<script type="text/javascript">
  video = document.getElementById("video");

  var image = new Image();
  image.src = "./GunFace.transparent.png";

  navigator.mediaDevices.getUserMedia( { audio: false, video: true } )
  .then( 
    function(stream) {
//      video.src = window.URL.createObjectURL(stream);
      video.srcObject = stream;
    }
  );

  video.addEventListener("loadedmetadata",
    function(e) {
//      setInterval(detection, 200 );

      (function animation() {
        detection();
        requestAnimationFrame(animation);
      })();

    }
  );


  function detection() {
    $("#video").faceDetection({
      complete: function (faces) {
//        console.log(faces);
        $('.face').remove();
        for (var i = 0, l = faces.length; i < l; i++) {

              image.style.cssText = 
                 "position:absolute;"
                +"left:"+faces[i].x+"px;"
                +"top:"+faces[i].y+"px;"
                +"width:"+faces[i].width+"px;"
                +"heigh:"+faces[i].height+"px";

              document.body.appendChild(image);


//          $('<div>', {
//            'class':'face',
//            'css': {
//              'position': 'absolute',
//              'left':     faces[i].x + 'px',
//              'top':      faces[i].y + 'px',
//              'width':    faces[i].width  + 'px',
//              'height':   faces[i].height + 'px'
//            }
//          })
//          .insertAfter(video);
        }
      },
      error: function (code, message) {
        alert('Error: ' + message);
      }
    });
  }

</script>
</body>
</html>
